<?xml version="1.0" ?>
<doc>
	<label auto="true" type="str" verify="true"><![CDATA[Develop]]></label>
	<author auto="true" type="list" verify="true">
		<item type="str"><![CDATA[TheSwitch]]></item>
	</author>
	<date auto="true" type="str" verify="true"><![CDATA[2022-12-16, 17:21]]></date>
	<link auto="true" type="str" verify="true"><![CDATA[https://habr.com/ru/post/703280/]]></link>
	<title auto="true" type="str" verify="true"><![CDATA[–£–¥–∞–ª—è–µ–º —Ñ–æ–Ω —É —Ñ–æ—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—è CoreML]]></title>
	<categories auto="true" type="list" verify="true">
		<item type="str"><![CDATA[–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥ iOS]]></item>
		<item type="str"><![CDATA[–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π]]></item>
		<item type="str"><![CDATA[–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã]]></item>
		<item type="str"><![CDATA[Swift]]></item>
		<item type="str"><![CDATA[–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ]]></item>
	</categories>
	<key_words auto="true" type="list" verify="true">
		<item type="str"><![CDATA[coreml]]></item>
		<item type="str"><![CDATA[iOS]]></item>
		<item type="str"><![CDATA[swift]]></item>
		<item type="str"><![CDATA[mlmodel]]></item>
		<item type="str"><![CDATA[images]]></item>
		<item type="str"><![CDATA[–º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ]]></item>
		<item type="str"><![CDATA[–≤—ã—Ä–µ–∑–∞—Ç—å —Ñ–æ–Ω]]></item>
		<item type="str"><![CDATA[—É–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞]]></item>
		<item type="str"><![CDATA[–º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ]]></item>
	</key_words>
	<text auto="true" type="str" verify="true"><![CDATA[–í—Å–µ–º –ø—Ä–∏–≤–µ—Ç! –û–¥–Ω–∞–∂–¥—ã –ø–µ—Ä–µ–¥–æ –º–Ω–æ–π –≤—Å—Ç–∞–ª–∞ –∑–∞–¥–∞—á–∞ —Å–¥–µ–ª–∞—Ç—å —Ñ–æ–Ω –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º, –±–µ–∑ –º–∞–º, –ø–∞–ø –∏ –±–µ–∫–Ω–¥–æ–≤... –ó–∞–¥–∞—á–∞ –µ—Å—Ç—å, –Ω–∞–¥–æ –µ—ë —Ä–µ—à–∞—Ç—å! –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ –≤—ã —É–∑–Ω–∞–µ—Ç–µ, —Å —á–µ–º –º–Ω–µ –ø—Ä–∏—à–ª–æ—Å—å —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è –∏ –∫–∞–∫ —è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª –≤—ã—Ä–µ–∑–∞–Ω–∏–µ –∑–∞–¥–Ω–µ–≥–æ —Ñ–æ–Ω–∞ —É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞ iOS.
–ó–∞—á–µ–º –≤–æ–æ–±—â–µ –≤–æ—Ç —ç—Ç–æ –≤–æ—Ç –≤—Å—ë ?
–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º —è —Ä–∞–±–æ—Ç–∞—é, –µ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ª–ª–∞–∂–∞. –ö–æ–ª–ª–∞–∂ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –æ–¥–µ–∂–¥—ã, –∞–∫—Å–µ—Å—Å—É–∞—Ä–æ–≤, –æ–±—É–≤–∏ –∏ –ø—Ä–æ—á–µ–≥–æ. –í—Å–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–∞—à–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞, –∏–º–µ—é—Ç –±–µ–ª—ã–π —Ñ–æ–Ω, –Ω–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —ç—Ç–æ—Ç —Ñ–æ–Ω –Ω—É–∂–Ω–æ –≤—ã—Ä–µ–∑–∞—Ç—å, –∞ –∏–Ω–∞—á–µ –ø–æ–ª—É—á–∏—Ç—Å—è –º–æ–∑–∞–∏–∫–∞ –∏–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏, –æ–±—Ä–µ–∑–∞–Ω–∏–µ —Ñ–æ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –Ω–∞ –±–µ–∫–µ–Ω–¥–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ —Å–∏–ª–∞–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ GPUImage, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Å—Ç–∞–≤–ª—è–ª –∂–µ–ª–∞—Ç—å –ª—É—á—à–µ–≥–æ...
–ü—Ä–∏–º–µ—Ä –æ–±—Ä–µ–∑–∞–Ω–∏—è —Ñ–æ–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GPUImage
–ö–∞–∫ –º–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ—á–µ–Ω—å –º–Ω–æ–≥–æ "—Å–Ω–µ–≥–∞" –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.
–†–µ—à–µ–Ω–æ, –≤–Ω–µ–¥—Ä—è–µ–º –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ !
–ò—â–µ–º —Å–ø–æ—Å–æ–± —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–Ω–µ–≥–æ —Ñ–æ–Ω–∞
–ù–∞ –ø—Ä–æ—Å—Ç–æ—Ä–∞—Ö –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –µ—Å—Ç—å —Ö–æ—Ä–æ—à–∏–µ —Ç—É—Ç–æ—Ä–∏–∞–ª—ã, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è DeeplabV3, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Å–∞–π—Ç–µ –êpple. –¢–æ–ª—å–∫–æ –µ—Å—Ç—å –æ–¥–Ω–æ –Ω–æ. –î–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –Ω–∞—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –µ—Å–ª–∏ —Å–∫–æ—Ä–º–∏—Ç—å –µ–π –∫–∞—Ä—Ç–∏–Ω–∫—É —Å –∫—Ä–æ—Å—Å–æ–≤–∫–∞–º–∏ –∏–ª–∏ —Å—É–º–∫–æ–π, –æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –Ω–µ–π.
–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω—ã–π –≥—É–≥–ª–∏–Ω–≥ –æ—Ç–∫—Ä—ã–ª –¥–ª—è –º–µ–Ω—è –ø—Ä–µ–∫—Ä–∞—Å–Ω—É—é –º–æ–¥–µ–ª—å –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º u2Net. –î–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –æ—á–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ —Å–µ–≥–º–µ–Ω—Ç–∏—Ä—É–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –Ω–∞ –æ–±—ä–µ–∫—Ç—ã, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–µ –Ω–∞ –Ω–µ–π. –ù–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–µ –≥–∏—Ç—Ö–∞–±–∞ –º–æ–¥–µ–ª—å–∫–∏ –ª–µ–∂–∞—Ç –≤ –Ω–µ–≤–µ–¥–æ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ .pth, –∞ –≤–µ–¥—å –Ω–∞—à —Ä–æ–¥–Ω–æ–π CoreML –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç .mlModel, —á—Ç–æ –¥–µ–ª–∞—Ç—å ?
–ï—Å—Ç—å –¥–≤–∞ –ø—É—Ç–∏:
–ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é python —Ç—É–ª–∑—É –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π –≤ .mlModel —Ñ–æ—Ä–º–∞—Ç
–ó–∞—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫—É –≥–∏—Ç—Ö–∞–±–∞, –≥–¥–µ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏ –≤—Å—ë –∑–∞ –≤–∞—Å
–í—ã–±–æ—Ä –æ—á–µ–≤–∏–¥–µ–Ω üòÖ
–í–Ω–µ–¥—Ä—è–µ–º U2Net –≤ —Å–≤–æ—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
–ò —Ç–∞–∫, –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ –±—ã –º–∞–≥–∏—è —Å–≤–µ—Ä—à–∏–ª–∞—Å—å, –Ω–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å–∫–∞ –æ–∫–∞–∑–∞–ª–∞—Å—å –≤–Ω—É—Ç—Ä–∏ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –ø—É—Ç—å - –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å –µ—ë –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é. –ù–∞ –≤—ã–±–æ—Ä –≤–∞–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –¥–≤–µ –º–æ–¥–µ–ª–∏, u2Net –∏ u2Netp, –ø–æ–∫–∞ –≤—ã–±–∏—Ä–∞–π—Ç–µ –ª—é–±—É—é, –≤ —á—ë–º –∏—Ö –æ—Ç–ª–∏—á–∏–µ –ø–æ–º–∏–º–æ —Ä–∞–∑–º–µ—Ä–∞ –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –¥–∞–ª–µ–µ.
–ú–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è —Å—Ä–µ–¥–∏ —Ñ–∞–π–ª–æ–≤
–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –º–æ–¥–µ–ª—å –æ–∫–∞–∂–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–æ–≤–æ–≥–æ –¥–µ—Ä–µ–≤–∞, –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∫–ª–∞—Å—Å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏, –Ω–∞–∑–≤–∞–Ω–∏–µ –µ–≥–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–µ –º–æ–¥–µ–ª—å–∫–∏.
–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–∞
–ù–∞–∫–æ–Ω–µ—Ü-—Ç–æ –Ω–∞—Å—Ç–∞–ª–æ –≤—Ä–µ–º—è –ø–æ–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å. –†–∞–∑–º–∏–Ω–∞–µ–º –ø–∞–ª—å—á–∏–∫–∏ !
–î–∞–≤–∞–π—Ç–µ, –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Å–¥–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —É –∫–∞–∂–¥–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ UIImage –∫–ª–∞—Å—Å–∞, —á—Ç–æ –±—ã, –µ—Å–ª–∏ –Ω–∞–º –≤–∑–¥—É–º–∞–µ—Ç—Å—è, –º—ã –º–æ–≥–ª–∏ –≤—ã—Ä–µ–∑–∞—Ç—å —Ñ–æ–Ω –≥–¥–µ —É–≥–æ–¥–Ω–æ !! –ò –∑–∞–±–µ–≥–∞—è –Ω–µ–º–Ω–æ–≥–æ –≤–ø–µ—Ä—ë–¥, —É—Ç–æ—á–Ω—é, —á—Ç–æ –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å–∞–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–µ –º–æ–¥–µ–ª–∏ –≤–æ –≤–∫–ª–∞–¥–∫–µ Predictions.
–†–∞–∑–º–µ—Ä—ã –≤—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
import UIKit

extension UIImage {
  func removeBackgroudIfPosible() -> UIImage? {
      let resizedImage: UIImage = resize(size: .init(width: 320, height: 320))
      ...
  }
}
–ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è resize
–¢–∞–∫, –∫–∞—Ä—Ç–∏–Ω–∫—É –º—ã –æ—Ç—Ä–µ—Å–∞–π–∑–∏–ª–∏ –ø–æ–¥ –Ω—É–∂–Ω—ã–µ –Ω–∞–º —Ä–∞–∑–º–µ—Ä—ã, —á—Ç–æ –¥–∞–ª—å—à–µ, —Å–ø—Ä–æ—Å–∏—Ç–µ –≤—ã ?
–î–∞–ª—å—à–µ - –º–∞–≥–∏—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ !!
import UIKit
extension UIImage {
    func removeBackgroudIfPosible() -> UIImage? {
        let resizedImage: UIImage = resize(size: .init(width: 320, height: 320))
        
        guard
            let resizedCGImage = resizedImage.cgImage,
            let originalCGImage = cgImage,
            let mlModel = try? u2netp(),
            let resultMask = try? mlModel.prediction(input: u2netpInput(in_0With: resizedCGImage)).out_p1 else {
            return nil
        }
        ...
    }
}
–î–∞–≤–∞–π—Ç–µ —è –æ–ø–∏—à—É, –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è, –∂–∏—Ä–Ω—ã–π guard –∏ —á—Ç–æ —Ç–∞–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.
resizedCGImage - –£ u2netpInput, –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤, –º—ã –±—É–¥–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–µ–º, —á—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç cgImage;
originalCGImage - cgImage –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–ª–µ–µ –¥–ª—è –Ω–∞–ª–æ–∂–µ–Ω–∏—è –º–∞—Å–∫–∏;
mlModel - –∏–Ω—Å—Ç–∞–Ω—Å –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞;
resultMask - —Ç–∞ —Å–∞–º–∞—è –º–∞–≥–∏—è! –§—É–Ω–∫—Ü–∏—è prediction, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–º u2netpOutput, –≥–¥–µ out_p1 –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –º–∞—Å–∫–∏ –Ω–∞—à–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è!
–ï—Å–ª–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –ø–æ–ª—É—á–∏–≤—à—É—é—Å—è –º–∞—Å–∫—É –≤ –∫–∞—Ä—Ç–∏–Ω–∫—É, —Ç–æ –º—ã —Å–º–æ–∂–µ–º —É–≤–∏–¥–µ—Ç—å —Ç–æ, –∫–∞–∫ –º–æ–¥–µ–ª—å–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∞ –≤—Ö–æ–¥—è—â–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏. –¢–∞–∫ –∫–∞–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∏–º–µ–µ—Ç —Ä–∞–∑–º–µ—Ä 320x320, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞—Ä–µ—Å–∞–π–∑–∏—Ç—å –µ—ë –ø–æ–¥ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã.
let originalImage = CIImage(cgImage: originalCGImage)
var maskImage = CIImage(cvPixelBuffer: resultMask)
        
let scaleX = originalImage.extent.width / maskImage.extent.width
let scaleY = originalImage.extent.height / maskImage.extent.height
maskImage = maskImage.transformed(by: .init(scaleX: scaleX, y: scaleY))

return UIImage(ciImage: maskImage)
–ú–∞—Å–∫–∏ –∏—Å—Ö–æ–¥–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
–í–∞—É! –í—ã–≥–ª—è–¥–∏—Ç –æ—á–µ–Ω—å –∞–∫–∫—É—Ä–∞—Ç–Ω–æ, –Ω–µ—Ç —Å–Ω–µ–≥–∞ –∏ –∫–∞–∫–∏-—Ç–æ —Å–∏–ª—å–Ω—ã—Ö –≤–∫—Ä–∞–ø–ª–µ–Ω–∏–π, –¥–∞–≤–∞–π—Ç–µ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—Ç—å –º–∞—Å–∫—É –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É !
–ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–ª—É—á–∏–≤—à—É—é—Å—è –º–∞—Å–∫—É
–£ Apple –µ—Å—Ç—å —Ö–æ—Ä–æ—à–∞—è —Å—Ç–∞—Ç—å—è, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∞—è –ø–æ–¥—Ö–æ–¥ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–µ–≥–º–µ–Ω—Ç–∏—Ä—É—é—â–µ–π –º–∞—Å–∫–∏ –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é. –ï—ë —Ç–æ –º—ã –∏ –≤–æ–∑—å–º—ë–º –∑–∞ –æ—Å–Ω–æ–≤—É —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞–º–∏.
let context = CIContext(options: nil)
        
guard let inputCGImage = context.createCGImage(originalImage, from: originalImage.extent) else {
    return nil
}
        
let blendFilter = CIFilter.blendWithRedMask()
        
blendFilter.inputImage = CIImage(cgImage: inputCGImage)
blendFilter.maskImage = maskImage
        
guard let outputCIImage = blendFilter.outputImage?.oriented(.up),
      let outputCGImage = context.createCGImage(outputCIImage, from: outputCIImage.extent) else {
        return nil
}
        
return UIImage(cgImage: outputCGImage)
–ò—Ç–∞–∫, –ø–æ—Å–∫–æ–ª—å–∫—É –º—ã –æ–ø–µ—Ä–∏—Ä—É–µ–º CIImage –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –∫ –Ω–µ–π —Ñ–∏–ª—å—Ç—Ä, —è –±—ã —Ö–æ—Ç–µ–ª —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ö–æ–¥–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CIContext —É–¥–∞–ª–æ—Å—å —ç—Ç–æ–≥–æ –¥–æ–±–∏—Ç—å—Å—è.
–ò—Å–ø–æ–ª—å–∑—É—è —ç—Ç–∏ –Ω–µ —Ö–∏—Ç—Ä—ã–µ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏, –º—ã –º–æ–∂–µ–º –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç!
–•–æ—á–µ—Ç—Å—è —Å–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ - –í–ê–£! –û —Ç–∞–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–º –æ–±—Ä–µ–∑–∞–Ω–∏–∏ –º—ã –º–æ–≥–ª–∏ —Ç–æ–ª—å–∫–æ –º–µ—á—Ç–∞—Ç—å, –∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–∏—à–ª–æ—Å—å –Ω–∞–ø–∏—Å–∞—Ç—å, –ø—Ä–æ—Å—Ç–æ –º–∏–∑–∏—Ä–Ω–æ–µ!
–§–∏–Ω–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–µ–∑–∞–Ω–∏—è —Ñ–æ—Ç–æ —É –∫–∞—Ä—Ç–∏–Ω–∫–∏
–í—Å—ë –∫—Ä—É—Ç–æ, –Ω–æ –∫–∞–∫ —Ç—ã —Å–æ–±–∏—Ä–∞–µ—à—å—Å—è —Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞–∫—É—é —Ç—è–∂—ë–ª—É—é –º–æ–¥–µ–ª—å ?
–ú–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è u2Net, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –¥–≤—É—Ö –≤–µ—Ä—Å–∏—è—Ö, u2Netp - light –≤–µ—Ä—Å–∏—è 4.6 –º–± –∏ u2Net - full –≤–µ—Ä—Å–∏—è 175.9 –º–± . –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –Ω–∏–º–∏ –æ—á–µ–Ω—å –æ—â—É—Ç–∏–º–∞, –µ—Å–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∏—Ö –≤–µ—Å. –ü–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é u2Net –¥–∞–∂–µ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å –≤ –≥–∏—Ç–µ, —Ç–∞–∫ —á—Ç–æ –Ω–µ —Å–æ–≤–µ—Ç—É—é –≤–∞–º –∫–æ–º–∏—Ç–∏—Ç—å –∫–æ–¥ —Å –ø–æ–ª–Ω–æ–π –º–æ–¥–µ–ª—å–∫–æ–π, –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –µ–≥–æ –ø—É—à–∏—Ç—å –Ω–∞ github. –ù–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã light –º–æ–¥–µ–ª–∏ –º–æ–∂–Ω–æ –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∏–∂–µ.
–û–±—Ä–µ–∑–∞–Ω–∏–µ —Ñ–æ–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Light –≤–µ—Ä—Å–∏–∏ –º–æ–¥–µ–ª–∏
–ú—ã –∂–µ –ø—Ä–∏–Ω—è–ª–∏ —Ä–µ—à–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ light –≤–µ—Ä—Å–∏—é –º–æ–¥–µ–ª–∏, –∞ –±–æ–ª—å—à—É—é, –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é –º–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤ —Ñ–æ–Ω–µ, —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏–ª–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞, –ø–æ–∫–∞ –º–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ï—Å–ª–∏ –≤—ã –∑–∞—Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å —Ç–æ–∂–µ —Å–∞–º–æ–µ, Apple –∏ —Ç—É—Ç –æ –Ω–∞—Å –ø–æ–¥—É–º–∞–ª–∏ –∏ –Ω–∞–ø–∏—Å–∞–ª–∏ —Ç—É—Ç–æ—Ä–∏–∞–ª !
–ò—Ç–æ–≥
–¢–µ–ø–µ—Ä—å –º—ã —É–º–µ–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–æ–¥–µ–ª—è–º–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –≤ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏—Ö –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ. –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ—Ä–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∏—è, —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, –æ—Ü–µ–Ω–∫–∏ –≥–ª—É–±–∏–Ω—ã, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –ø–æ–∑—ã —á–µ–ª–æ–≤–µ–∫–∞ –∏ —ç—Ç–æ –≤—Å—ë —Ç–æ–ª—å–∫–æ –ø—Ä–æ —Ñ–æ—Ç–æ, –∞ –≤–µ–¥—å –º–æ–∂–Ω–æ –µ—â—ë –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–µ–∫—Å—Ç–æ–º !
–ü–æ–º–∏–º–æ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, iOS –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ñ—Ä–∞–µ–º–≤–æ—Ä–∫ Vision, –∫–æ—Ç–æ—Ä—ã–π, –æ–ø–µ—Ä–∏—Ä—É—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è, –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –ª–∏—Ü–æ, –∫–∏—Å—Ç—å, —à—Ç—Ä–∏—Ö–∫–æ–¥ –∏–ª–∏ —á–µ–ª–æ–≤–µ–∫–∞!
–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–æ—á—Ç–µ–Ω–∏–µ! –ù–∞–¥–µ—é—Å—å, —á—Ç–æ —ç—Ç–∞ —Å—Ç–∞—Ç—å—è –ø–æ–º–æ–≥–ª–∞ –≤–∞–º —Ä–µ—à–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é –∑–∞–¥–∞—á—É –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–º–æ–≥–ª–∞ —É–∑–Ω–∞—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å ML –º–æ–¥–µ–ª—è–º–∏ –≤ iOS.
–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
–°–ø–∏—Å–æ–∫ ML –º–æ–¥–µ–ª–µ–π –æ—Ç Apple
–¢—É–ª–∑–∞ –ø–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π –≤ mlModel
–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ ML –º–æ–¥–µ–ª–∏
–°—Ç–∞—Ç—å—è Apple –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–∞—Å–∫–∏
–°—Ç–∞—Ç—å—è Apple –ø–æ –∑–∞–≥—Ä—É–∑–∫–∏ ML –º–æ–¥–µ–ª–∏ –∏–∑ —Å–µ—Ç–∏
–°—Ç–∞—Ç—å—è –ø–æ —É–¥–∞–ª–µ–Ω–∏—é —Ñ–æ–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º DeeplabV3 –í—Å–µ–º –ø—Ä–∏–≤–µ—Ç! –û–¥–Ω–∞–∂–¥—ã –ø–µ—Ä–µ–¥–æ –º–Ω–æ–π –≤—Å—Ç–∞–ª–∞ –∑–∞–¥–∞—á–∞ —Å–¥–µ–ª–∞—Ç—å —Ñ–æ–Ω –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º, –±–µ–∑ –º–∞–º, –ø–∞–ø –∏ –±–µ–∫–Ω–¥–æ–≤... –ó–∞–¥–∞—á–∞ –µ—Å—Ç—å, –Ω–∞–¥–æ –µ—ë —Ä–µ—à–∞—Ç—å! –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ –≤—ã —É–∑–Ω–∞–µ—Ç–µ, —Å —á–µ–º –º–Ω–µ –ø—Ä–∏—à–ª–æ—Å—å —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è –∏ –∫–∞–∫ —è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª –≤—ã—Ä–µ–∑–∞–Ω–∏–µ –∑–∞–¥–Ω–µ–≥–æ —Ñ–æ–Ω–∞ —É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞ iOS.   –ó–∞—á–µ–º –≤–æ–æ–±—â–µ –≤–æ—Ç —ç—Ç–æ –≤–æ—Ç –≤—Å—ë ? –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º —è —Ä–∞–±–æ—Ç–∞—é, –µ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ª–ª–∞–∂–∞. –ö–æ–ª–ª–∞–∂ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –æ–¥–µ–∂–¥—ã, –∞–∫—Å–µ—Å—Å—É–∞—Ä–æ–≤, –æ–±—É–≤–∏ –∏ –ø—Ä–æ—á–µ–≥–æ. –í—Å–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–∞—à–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞, –∏–º–µ—é—Ç –±–µ–ª—ã–π —Ñ–æ–Ω, –Ω–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —ç—Ç–æ—Ç —Ñ–æ–Ω –Ω—É–∂–Ω–æ –≤—ã—Ä–µ–∑–∞—Ç—å, –∞ –∏–Ω–∞—á–µ –ø–æ–ª—É—á–∏—Ç—Å—è –º–æ–∑–∞–∏–∫–∞ –∏–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏, –æ–±—Ä–µ–∑–∞–Ω–∏–µ —Ñ–æ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –Ω–∞ –±–µ–∫–µ–Ω–¥–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ —Å–∏–ª–∞–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ GPUImage, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Å—Ç–∞–≤–ª—è–ª –∂–µ–ª–∞—Ç—å –ª—É—á—à–µ–≥–æ...]]></text>
</doc>
